import{au as U,p as L,g as O,h as Y,f as H,o as V,n as $,d as J,q as P,l as Q}from"./DgrlDNDf.js";import{s as I,j as ee,k as ae,m as ne,o as ie,e as re,S as oe,f as te}from"./eTtyDkgu.js";import{aW as se,aX as W,aY as le,aA as K,aZ as fe,a_ as de,a$ as ce,aS as k,b0 as Z,aO as ue,b1 as me}from"./B8bEpPzb.js";import{H as ve}from"./LyrMl2Ci.js";function Re(a,e){return q(a,e).dimensions}function q(a,e){se(a)||(a=W(a)),e=e||{};var o=e.coordDimensions||[],n=e.dimensionsDefine||a.dimensionsDefine||[],r=U(),i=[],s=De(a,o,n,e.dimensionsCount),u=e.canOmitUnusedDimensions&&I(s),c=n===a.dimensionsDefine,h=c?ee(a):ae(n),C=e.encodeDefine;!C&&e.encodeDefaulter&&(C=e.encodeDefaulter(a,s));for(var p=U(C),x=new le(s),g=0;g<x.length;g++)x[g]=-1;function M(l){var f=x[l];if(f<0){var d=n[l],v=V(d)?d:{name:d},t=new ie,S=v.name;S!=null&&h.get(S)!=null&&(t.name=t.displayName=S),v.type!=null&&(t.type=v.type),v.displayName!=null&&(t.displayName=v.displayName);var m=i.length;return x[l]=m,t.storeDimIndex=l,i.push(t),t}return i[f]}if(!u)for(var g=0;g<s;g++)M(g);p.each(function(l,f){var d=K(l).slice();if(d.length===1&&!L(d[0])&&d[0]<0){p.set(f,!1);return}var v=p.set(f,[]);O(d,function(t,S){var m=L(t)?h.get(t):t;m!=null&&m<s&&(v[S]=m,_(M(m),f,S))})});var D=0;O(o,function(l){var f,d,v,t;if(L(l))f=l,t={};else{t=l,f=t.name;var S=t.ordinalMeta;t.ordinalMeta=null,t=Y({},t),t.ordinalMeta=S,d=t.dimsDef,v=t.otherDims,t.name=t.coordDim=t.coordDimIndex=t.dimsDef=t.otherDims=null}var m=p.get(f);if(m!==!1){if(m=K(m),!m.length)for(var w=0;w<(d&&d.length||1);w++){for(;D<s&&M(D).coordDim!=null;)D++;D<s&&m.push(D++)}O(m,function(X,B){var N=M(X);if(c&&t.type!=null&&(N.type=t.type),_(H(N,t),f,B),N.name==null&&d){var R=d[B];!V(R)&&(R={name:R}),N.name=N.displayName=R.name,N.defaultTooltip=R.defaultTooltip}v&&H(N.otherDims,v)})}});function _(l,f,d){fe.get(f)!=null?l.otherDims[f]=d:(l.coordDim=f,l.coordDimIndex=d,r.set(f,!0))}var F=e.generateCoord,A=e.generateCoordCount,G=A!=null;A=F?A||1:0;var T=F||"value";function j(l){l.name==null&&(l.name=l.coordDim)}if(u)O(i,function(l){j(l)}),i.sort(function(l,f){return l.storeDimIndex-f.storeDimIndex});else for(var b=0;b<s;b++){var y=M(b),z=y.coordDim;z==null&&(y.coordDim=ye(T,r,G),y.coordDimIndex=0,(!F||A<=0)&&(y.isExtraCoord=!0),A--),j(y),y.type==null&&(de(a,b)===ce.Must||y.isExtraCoord&&(y.otherDims.itemName!=null||y.otherDims.seriesName!=null))&&(y.type="ordinal")}return ge(i),new ne({source:a,dimensions:i,fullDimensionCount:s,dimensionOmitted:u})}function ge(a){for(var e=U(),o=0;o<a.length;o++){var n=a[o],r=n.name,i=e.get(r)||0;i>0&&(n.name=r+(i-1)),i++,e.set(r,i)}}function De(a,e,o,n){var r=Math.max(a.dimensionsDetectedCount||1,e.length,o.length,n||0);return O(e,function(i){var s;V(i)&&(s=i.dimsDef)&&(r=Math.max(r,s.length))}),r}function ye(a,e,o){if(o||e.hasKey(a)){for(var n=0;e.hasKey(a+n);)n++;a+=n}return e.set(a,!0),a}var pe=function(){function a(e){this.coordSysDims=[],this.axisMap=U(),this.categoryAxisMap=U(),this.coordSysName=e}return a}();function he(a){var e=a.get("coordinateSystem"),o=new pe(e),n=Ce[e];if(n)return n(a,o,o.axisMap,o.categoryAxisMap),o}var Ce={cartesian2d:function(a,e,o,n){var r=a.getReferringComponents("xAxis",k).models[0],i=a.getReferringComponents("yAxis",k).models[0];e.coordSysDims=["x","y"],o.set("x",r),o.set("y",i),E(r)&&(n.set("x",r),e.firstCategoryDimIndex=0),E(i)&&(n.set("y",i),e.firstCategoryDimIndex==null&&(e.firstCategoryDimIndex=1))},singleAxis:function(a,e,o,n){var r=a.getReferringComponents("singleAxis",k).models[0];e.coordSysDims=["single"],o.set("single",r),E(r)&&(n.set("single",r),e.firstCategoryDimIndex=0)},polar:function(a,e,o,n){var r=a.getReferringComponents("polar",k).models[0],i=r.findAxisModel("radiusAxis"),s=r.findAxisModel("angleAxis");e.coordSysDims=["radius","angle"],o.set("radius",i),o.set("angle",s),E(i)&&(n.set("radius",i),e.firstCategoryDimIndex=0),E(s)&&(n.set("angle",s),e.firstCategoryDimIndex==null&&(e.firstCategoryDimIndex=1))},geo:function(a,e,o,n){e.coordSysDims=["lng","lat"]},parallel:function(a,e,o,n){var r=a.ecModel,i=r.getComponent("parallel",a.get("parallelIndex")),s=e.coordSysDims=i.dimensions.slice();O(i.parallelAxisIndex,function(u,c){var h=r.getComponent("parallelAxis",u),C=s[c];o.set(C,h),E(h)&&(n.set(C,h),e.firstCategoryDimIndex==null&&(e.firstCategoryDimIndex=c))})}};function E(a){return a.get("type")==="category"}function Se(a,e){var o=a.get("coordinateSystem"),n=ve.get(o),r;return e&&e.coordSysDims&&(r=P(e.coordSysDims,function(i){var s={name:i},u=e.axisMap.get(i);if(u){var c=u.get("type");s.type=te(c)}return s})),r||(r=n&&(n.getDimensionsInfo?n.getDimensionsInfo():n.dimensions.slice())||["x","y"]),r}function xe(a,e,o){var n,r;return o&&O(a,function(i,s){var u=i.coordDim,c=o.categoryAxisMap.get(u);c&&(n==null&&(n=s),i.ordinalMeta=c.getOrdinalMeta(),e&&(i.createInvertedIndices=!0)),i.otherDims.itemName!=null&&(r=!0)}),!r&&n!=null&&(a[n].otherDims.itemName=0),n}function Ue(a,e,o){o=o||{};var n=e.getSourceManager(),r,i=!1;a?(i=!0,r=W(a)):(r=n.getSource(),i=r.sourceFormat===Z);var s=he(e),u=Se(e,s),c=o.useEncodeDefaulter,h=$(c)?c:c?J(ue,u,e):null,C={coordDimensions:u,generateCoord:o.generateCoord,encodeDefine:e.getEncode(),encodeDefaulter:h,canOmitUnusedDimensions:!i},p=q(r,C),x=xe(p.dimensions,o.createInvertedIndices,s),g=i?null:n.getSharedDataStore(p),M=re(e,{schema:p,store:g}),D=new oe(p,e);D.setCalculationInfo(M);var _=x!=null&&Me(r)?function(F,A,G,T){return T===x?G:this.defaultDimValueGetter(F,A,G,T)}:null;return D.hasItemOption=!1,D.initData(i?r:g,null,_),D}function Me(a){if(a.sourceFormat===Z){var e=Ae(a.data||[]);return!Q(me(e))}}function Ae(a){for(var e=0;e<a.length&&a[e]==null;)e++;return a[e]}export{Re as a,Ue as c,q as p};
